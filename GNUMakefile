SRCS=example.c sv.c sv.h
EXE=example
TESTS=svtest
TEST_FILES=test1.csv \
zero.tsv \
one.tsv \
test1.tsv

FILES=README COPYING COPYING.LIB LICENSE-2.0.txt LICENSE.txt NOTICE \
$(TEST_FILES) \
$(SRCS)

PACKAGE=libsv
VERSION=1.0.0

PV=$(PACKAGE)-$(VERSION)
TARBALL=$(PV).tar.gz

LDFLAGS=-g
CPPFLAGS=-g -I. -DHAVE_STDLIB_H -DHAVE_UNISTD_H -DHAVE_ERRNO_H

$(EXE): sv.o example.o
sv.c: sv.h
example.c: sv.h

dist: $(FILES)
	rm -rf $(PV) && \
	mkdir $(PV) && \
	cp $(FILES) $(PV) && \
	tar cfz $(TARBALL) $(PV) && \
	rm -rf $(PV)

clean:
	rm -f *.o *~ *.tar.gz $(EXE)

check: $(TESTS)
	@rc=0; \
	for t in $(TESTS); do \
	  echo "Running test $$t"; \
	  ./$$t; \
	  status=$$?; \
	  if test $$status != 0; then \
	    rc=1; \
	  fi; \
	done; \
	exit $$rc

svtest: svtest.o sv.o
